<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>toposs/settings</title>
    <link rel="shortcut icon" href="Icon Toposs.ico">
    <link rel="stylesheet" href="Beranda.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Modal Edit Data -->
    <div id="editModal" class="modal">
            
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>

            <div class="inputModal">
                <h3 id="judulModal">Edit Data</h3>
                <table>
                    <tr>
                        <td><label for="nama">Nama Barang</label></td>
                        <td><input type="text" name="nama" id="namaEdit"></td>
                    </tr>
                    <tr>
                        <td><label for="harga">Harga Satuan</label></td>
                        <td><input type="text" name="harga" id="hargaEdit"></td>
                    </tr>
                    <tr>
                        <td><label for="qty">Qty</label></td>
                        <td><input type="text" name="qty" id="qtyEdit"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input type="button" value="Submit" name="submit" id="submitEdit" class="btn"></td>
                    </tr>
                </table>
            </div>
        </div>
        
    </div>
    <div class="container">
        <!-- header -->
        <div class="flex-column">
            <nav>
                <div class="flex-row">
                    <div class="header">
                        <img class="logo" src="Logo Toposs.png" alt="Logo">
                    </div>
                    <div class="search">
                        <form class="searchbox">
                            <input class="searchtext" type="text" placeholder="Search Disini...">
                            <a href="Find.html"><span class="material-symbols-outlined searchicon">search</span></a>
                        </form>
                    </div>
                    <div class="icon">
                        <a href="Saved.html">
                            <span class="material-symbols-outlined">favorite</span><br>
                            <span>Saved</span>
                        </a>
                    </div>
                    <div class="icon">
                        <a href="Cart.html">
                            <span class="material-symbols-outlined">shopping_cart</span><br>
                            <span>Cart</span>
                        </a>
                    </div>
                    <div class="icon" id="tablogin">
                        <a href="Login.html">
                            <span class="material-symbols-outlined">person</span><br>
                            <span>Sign In</span>
                        </a>
                    </div>
                    <div class="icon" id="profile" style="display: none;">
                        <div class="dropdown">
                            <button class="dropbtn">
                                <span class="material-symbols-outlined">account_box</span>
                                <span class="material-symbols-outlined">arrow_drop_down</span>
                            </button>
                            <div class="dropdown-content">
                                <a href="Myprofile.html">My Profile</a>
                                <hr>
                                <a href="Upload.html">Upload your artwork</a>
                                <a href="Earnings.html">My Earnings</a>
                                <a href="Published.html">Upload History</a>
                                <a href="Order.html">My Orders</a>
                                <a href="Settings.html">Account Settings</a>
                                <hr>
                                <a id="logout">Log Out</a>
                            </div>
                          </div> 
                    </div>
                </div>
            </nav>

            <!-- content -->
            <div class="flex-row">
                <div class="settings">
                    <h1>Account Settings</h1>
                    <hr>
                    <table>
                        <tr>
                            <td>First name/Nick</td>
                            <td>Last name</td>
                            <td>E-mail</td>
                            <td><a onclick="btnEdit()"><span class="material-symbols-outlined">border_color</span>edit</a></td>
                        </tr>
                        <tr>
                            <td id="fname"></td>
                            <td id="lname"></td>
                            <td id="email"></td>
                        </tr>
                        <tr>
                            <td>Your Toposs Profile</td>
                        </tr>
                        <tr>
                            <td id="toposs"></td>
                        </tr>
                    </table>
                    <hr>
                    <table>
                        <tr>
                            <td>Password</td>
                            <td></td>
                            <td></td>
                            <td>Change password</td>
                        </tr>
                    </table>
                    <hr>
                    <table>
                        <tr>
                            <td>Toposs account</td>
                            <td></td>
                            <td></td>
                            <td>Deactive account</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="flex-row">
                <div class="footer">
                    <h3>Support</h3>
                    <p>Terms of use</p>
                    <p>Contact us</p>
                    <p>Copyrights</p>
                    <p>Privacy policy</p>
                </div>
                <div class="footer">
                    <h3>Partner</h3>
                    <img class="partner" src="img/Tokotok nama.png" alt="Logo Tokotok">
                </div>
                <div class="footer">
                    <h3>Secure payment</h3>
                    <img class="secure" src="img/payment.png" alt="Secure payment">
                </div>
                <div class="footer">
                    <h3>Find us</h3>
                    <img class="find" src="img/fb.png" alt="Facebook">
                    <img class="find" src="img/ig.png" alt="Instagram">
                    <img class="find" src="img/twit.png" alt="Twitter">
                    <img class="find" src="img/p.png" alt="Pinterest">
                </div>
            </div>    
        </div>        
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.2/firebase-app.js";
        import { getDatabase, ref, set, push, get, child, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.8.2/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.8.2/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBtwsIft9BS24yfM0qAJ7VUBfE4rIXEdrM",
            authDomain: "tokoposter-59447.firebaseapp.com",
            projectId: "tokoposter-59447",
            storageBucket: "tokoposter-59447.appspot.com",
            messagingSenderId: "660302277836",
            appId: "1:660302277836:web:a607e85e507db70a682669"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();    

        // Menampilkan nama yang login
        function ambilDataFirebase(){
            const dbRef = ref(database,"users");
            
            onValue(dbRef,(snapshot) => {
                let barang = [];
                snapshot.forEach(childSnapshot => {
                    let temp = childSnapshot.val();
                    temp["key"] = childSnapshot.key;
                    barang.push(temp);
                });
                
                tambahkanItemKeHome(barang);
            });
        }
        
        function tambahkanItemKeList(fname, lname, email, authen){
            document.getElementById("fname").innerHTML = fname;
            document.getElementById("lname").innerHTML = lname;
            document.getElementById("email").innerHTML = email;
            document.getElementById("toposs").innerHTML = authen;
        }
        
        function tambahkanItemKeHome(barang){
            barang.forEach((element) => {
                tambahkanItemKeList(element.fname, element.lname, element.email, element.authen);
            });
        };

        window.onload = ambilDataFirebase();

        //Mengedit data
        var submitEdit = document.getElementById("submitEdit");
        submitEdit.onclick = function () {
            updateData(selectedkey);
        };

        function updateData(id) {
            let data = {
            nama: namaEdit.value,
            harga: hargaEdit.value,
            qty: qtyEdit.value,
            };

            update(ref(database, "kasir/" + id), data)
            .then(() => {
                namaEdit.value = "";
                hargaEdit.value = "";
                qtyEdit.value = "";
                editModal.style.display = "none";
                alert("Data berhasil diupdate");
            })
            .catch((error) => {
                alert("Data gagal ditambahkan");
            });
        }

        // logout
        logout.addEventListener('click',(e)=>{

        signOut(auth).then(() => {
        // Sign-out successful.
        document.getElementById("profile").style.display="none";
        document.getElementById("tablogin").style.display="inline";
        document.getElementById("fname").style.display="none";
        document.getElementById("lname").style.display="none";
        document.getElementById("email").style.display="none";
        document.getElementById("toposs").style.display="none";
        alert('loged out');
        }).catch((error) => {
        // An error happened.
        const errorCode = error.code;
        const errorMessage = error.message;

            alert(errorMessage);
        });

        });
        
        const user = auth.currentUser;
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("profile").style.display="inline";
                document.getElementById("tablogin").style.display="none";
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/firebase.User

                const uid = user.uid;
                //bla bla bla
                // ...
            } else {
                // User is signed out
                // ...
                //bla bla bla
            }
        });
      </script>
</body>
</html>